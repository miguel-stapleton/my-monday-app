import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import i,{forwardRef as t,useRef as r,useState as n,useCallback as s,useMemo as a}from"react";import l from"classnames";import{camelCase as d}from"lodash-es";import{isForwardRef as m}from"react-is";import c from"../Dialog/Dialog.js";import g from"../DialogContentContainer/DialogContentContainer.js";import u from"../Tooltip/Tooltip.js";import p from"../../hooks/ssr/useIsomorphicLayoutEffect.js";import f from"../../hooks/useMergeRef.js";import{BUTTON_ICON_SIZE as h,SMALL_BUTTON_ICON_SIZE as T}from"../Button/ButtonConstants.js";import{withStaticProps as v}from"../../types/withStaticProps.js";import"../../utils/colors-vars-map.js";import{MenuButtonSize as C,MenuButtonComponentPosition as E}from"./MenuButtonConstants.js";import{DialogSize as S,DialogPosition as w,HideShowEvent as j}from"../Dialog/DialogConstants.js";import{NOOP as O}from"../../utils/function-utils.js";import{getStyle as y}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as b,ComponentDefaultTestId as M}from"../../tests/testIds.js";import P from"./MenuButton.module.scss.js";import{ComponentVibeId as N}from"../../tests/constants.js";import D from"../../../icons/dist/react/Menu.js";var _={main:8,secondary:0},A=[c.hideShowTriggers.ESCAPE_KEY,c.hideShowTriggers.TAB_KEY],B=v(t((function(t,v){var C=t.id,E=t.className,S=t.openDialogComponentClassName,w=t.children,j=t.component,B=void 0===j?D:j,I=t.componentPosition,x=void 0===I?"start":I,z=t.size,H=void 0===z?"small":z,K=t.open,R=void 0!==K&&K,k=t.onClick,L=void 0===k?O:k,U=t.zIndex,Y=void 0===U?null:U,W=t.ariaLabel,F=void 0===W?"Menu":W,V=t.closeMenuOnItemClick,q=t.dialogOffset,G=void 0===q?_:q,J=t.dialogPosition,Q=void 0===J?c.positions.BOTTOM_START:J,X=t.dialogClassName,Z=t.dialogPaddingSize,$=void 0===Z?g.sizes.SMALL:Z,ee=t.dialogShowTriggerIgnoreClass,oe=t.dialogHideTriggerIgnoreClass,ie=t.onMenuHide,te=void 0===ie?O:ie,re=t.onMenuShow,ne=void 0===re?O:re,se=t.disabled,ae=void 0!==se&&se,le=t.text,de=t.tooltipContent,me=t.tooltipProps,ce=t.tooltipTriggers,ge=void 0===ce?["mouseleave"]:ce,ue=t.tooltipPosition,pe=void 0===ue?"right":ue,fe=t.startingEdge,he=void 0===fe?"bottom":fe,Te=t.removeTabCloseTrigger,ve=void 0!==Te&&Te,Ce=t.tooltipReferenceClassName,Ee=t.hideWhenReferenceHidden,Se=void 0===Ee||Ee,we=t.dialogContainerSelector,je=t.active,Oe=t.triggerElement,ye=void 0===Oe?"button":Oe,be=t.showTooltipOnlyOnTriggerElement,Me=t["data-testid"],Pe=t.closeDialogOnContentClick,Ne=void 0!==Pe&&Pe,De=t.ariaControls,_e=r(null),Ae=f(v,_e),Be=n(R),Ie=e(Be,2),xe=Ie[0],ze=Ie[1],He=null!=je?je:xe,Ke=s((function(e){te(),ze(!1);var o=_e.current;o&&e&&window.requestAnimationFrame((function(){o.focus()}))}),[te]),Re=s((function(e){var o=A.includes(e.key);(o||V)&&e.propagate&&Ke(o)}),[V,Ke]),ke=s((function(e,o){Ke(xe&&A.includes(o))}),[Ke,xe]),Le=s((function(){ze(!0),ne()}),[ze,ne]),Ue=a((function(){var e=new Set([c.hideShowTriggers.CLICK_OUTSIDE,c.hideShowTriggers.TAB_KEY,c.hideShowTriggers.ESCAPE_KEY]);return Ne&&(e.add(c.hideShowTriggers.CONTENT_CLICK),e.add(c.hideShowTriggers.ENTER)),ve&&e.delete(c.hideShowTriggers.TAB_KEY),[i.Children.toArray(w).map((function(o){if(!i.isValidElement(o))return null;var t={};return o.type&&o.type.supportFocusOnMount&&(t.focusOnMount=!0,e.delete(c.hideShowTriggers.ESCAPE_KEY)),o.type&&o.type.isMenu&&(t.onClose=Re),i.cloneElement(o,t)})),Array.from(e)]}),[w,Re,Ne,ve]),Ye=e(Ue,2),We=Ye[0],Fe=Ye[1],Ve=a((function(){return 0===We.length?null:i.createElement(g,{size:$,type:g.types.POPOVER},We)}),[We,$]),qe=a((function(){return Object.assign(Object.assign({},_),G)}),[G]),Ge=B,Je=a((function(){switch(H){case"xxs":case"xs":return T;case"small":case"medium":case"large":return h;default:return 24}}),[H]),Qe=Ge?i.createElement(Ge,{size:""+Je,role:"img","aria-hidden":"true"}):null;p((function(){ze(R)}),[R,ze]);var Xe="button"===ye?{ref:Ae}:{active:He,disabled:ae,ref:m(ye)?Ae:void 0},Ze=i.createElement(ye,Object.assign({id:C,"data-testid":Me||b(M.MENU_BUTTON,C),"data-vibe":N.MENU_BUTTON,type:"button",className:l(P.wrapper,E,y(P,d("size-".concat(H))),o(o(o(o({},P.active,He),y(P,S),xe&&S),P.disabled,ae),P.text,le)),"aria-haspopup":"true","aria-expanded":xe,"aria-controls":De,"aria-label":!le&&F,onMouseUp:function(e){ae?e.currentTarget.blur():L(e)},"aria-disabled":ae},Xe),"start"===x&&Qe,le&&i.createElement("span",{className:P.innerText},le),"end"===x&&Qe),$e=function(e){return i.createElement(c,{wrapperClassName:X,position:Q,containerSelector:we,startingEdge:he,animationType:"expand",content:Ve,moveBy:qe,showTrigger:ae?[]:["click","enter"],hideTrigger:Fe,showTriggerIgnoreClass:ee,hideTriggerIgnoreClass:oe,useDerivedStateFromProps:!0,onDialogDidShow:Le,onDialogDidHide:ke,zIndex:Y,isOpen:xe,hideWhenReferenceHidden:Se},e)},eo=function(e){return i.createElement(u,Object.assign({content:de,position:pe,showTrigger:"mouseenter",hideTrigger:ge,referenceWrapperClassName:Ce,hideWhenReferenceHidden:Se},me),e)};return be?$e(eo(Ze)):eo($e(Ze))})),{sizes:C,paddingSizes:S,dialogPositions:w,hideTriggers:j,componentPositions:E});export{B as default};
//# sourceMappingURL=MenuButton.js.map
