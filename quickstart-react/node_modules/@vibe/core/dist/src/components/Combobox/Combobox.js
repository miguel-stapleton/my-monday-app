import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{camelCase as t,noop as i,isFunction as s}from"lodash-es";import r from"classnames";import a,{forwardRef as n,useRef as l,useState as c,useCallback as d,useMemo as m}from"react";import{getStyle as p}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as u,ComponentDefaultTestId as v}from"../../tests/testIds.js";import b from"../../hooks/useMergeRef.js";import f from"../Search/Search.js";import{BASE_SIZES as h}from"../../constants/sizes.js";import C from"../Button/Button.js";import g from"../Text/Text.js";import x from"./components/ComboboxOption/ComboboxOption.js";import{defaultFilter as y}from"./ComboboxService.js";import{ComboboxItems as I}from"./components/ComboboxItems/ComboboxItems.js";import{StickyCategoryHeader as O}from"./components/StickyCategoryHeader/StickyCategoryHeader.js";import{useItemsData as N,useKeyboardNavigation as j}from"./ComboboxHelpers/ComboboxHelpers.js";import{getOptionId as S}from"./helpers.js";import{withStaticProps as R}from"../../types/withStaticProps.js";import"../../utils/colors-vars-map.js";import{COMBOBOX_LISTBOX_ID as k}from"./components/ComboboxConstants.js";import F from"./Combobox.module.scss.js";var H=R(n((function(n,h){var x=n.className,R=void 0===x?"":x,H=n.optionClassName,E=void 0===H?"":H,A=n.searchWrapperClassName,L=n.stickyCategoryClassName,M=n.searchIcon,w=n.id,T=void 0===w?"":w,z=n.placeholder,B=void 0===z?"":z,V=n.size,W=void 0===V?"medium":V,P=n.defaultVisualFocusFirstIndex,D=n.optionLineHeight,_=void 0===D?32:D,X=n.optionsListHeight,q=n.autoFocus,G=void 0!==q&&q,J=n.disabled,K=void 0!==J&&J,Q=n.options,U=void 0===Q?[]:Q,Y=n.categories,Z=n.withCategoriesDivider,$=void 0!==Z&&Z,ee=n.noResultsMessage,oe=void 0===ee?"No results found":ee,te=n.onAddNew,ie=n.addNewLabel,se=void 0===ie?"Add new":ie,re=n.onClick,ae=void 0===re?function(e){}:re,ne=n.filter,le=void 0===ne?y:ne,ce=n.disableFilter,de=void 0!==ce&&ce,me=n.filterValue,pe=n.onFilterChanged,ue=n.loading,ve=void 0!==ue&&ue,be=n.onOptionHover,fe=void 0===be?i:be,he=n.onOptionLeave,Ce=void 0===he?i:he,ge=n.shouldScrollToSelectedItem,xe=void 0===ge||ge,ye=n.noResultsRenderer,Ie=n.stickyCategories,Oe=void 0!==Ie&&Ie,Ne=n.optionRenderer,je=void 0===Ne?null:Ne,Se=n.renderOnlyVisibleOptions,Re=void 0!==Se&&Se,ke=n.clearFilterOnSelection,Fe=void 0!==ke&&ke,He=n.maxOptionsWithoutScroll,Ee=n.defaultFilter,Ae=void 0===Ee?"":Ee,Le=n.searchInputAriaLabel,Me=void 0===Le?"Search for content":Le,we=n["data-testid"],Te=n.debounceRate,ze=n.searchInputRef,Be=n.renderAction,Ve=n.hideRenderActionOnInput,We=l(null),Pe=l(null),De=b(h,We),_e=b(Pe,ze),Xe=c(me||Ae),qe=e(Xe,2),Ge=qe[0],Je=qe[1];void 0!==me&&me!==Ge&&Je(me);var Ke=d((function(e){eo(-1),pe&&pe(e),Je(e)}),[Je,pe]),Qe=d((function(e,o,t){fe(e,o,t)}),[fe]),Ue=m((function(){return de?U:le(Ge,U)}),[U,Ge,le,de]),Ye=c(-1),Ze=e(Ye,2),$e=Ze[0],eo=Ze[1],oo=d((function(e){return void 0!==e&&Ue[e]&&!Ue[e].disabled}),[Ue]),to=d((function(){te&&te(Ge),Je("")}),[te,Ge,Je]),io=Ue.length>0,so=Ge.length>0;var ro=c(),ao=e(ro,2),no=ao[0],lo=ao[1],co=d((function(e){var o;(null===(o=null==e?void 0:e.category)||void 0===o?void 0:o.label)!==(null==no?void 0:no.label)&&lo(null==e?void 0:e.category)}),[no]),mo=N({categories:Y,options:Ue,filterValue:Ge,withCategoriesDivider:$,optionLineHeight:_}),po=mo.items,uo=mo.itemsMap,vo=mo.selectableItems,bo=d((function(e,o){ae(vo[o]),oo(o)&&eo(o),Fe&&Ke("")}),[ae,vo,oo,Fe,Ke]),fo=j({getOptionId:S,defaultVisualFocusFirstIndex:P,onClick:bo,isChildSelectable:oo,options:vo,inputRef:_e}),ho=fo.visualFocusItemIndex,Co=fo.visualFocusItemId,go=fo.onOptionClick;return a.createElement(g,{type:"text2",ref:De,className:r(F.combobox,R,p(F,t("size-"+W)),o(o({},F.empty,!io),F.stickyCategory,Oe)),id:T,"data-testid":we||u(v.COMBOBOX,T),ellipsis:!1},a.createElement("div",{className:F.comboboxList,style:{maxHeight:X}},a.createElement(f,{ref:_e,value:Ge,className:r(F.comboboxSearchWrapper,A),inputAriaLabel:Me,currentAriaResultId:Co,id:"combobox-search",placeholder:B,size:W,disabled:K,onChange:Ke,autoFocus:G,loading:ve,searchIconName:M,ariaExpanded:so||io,ariaHasPopup:"listbox",searchResultsContainerId:T?"".concat(T,"-listbox"):k,debounceRate:Te,renderAction:Be,hideRenderActionOnInput:Ve}),Oe&&a.createElement(O,{label:null==no?void 0:no.label,color:null==no?void 0:no.color,className:L}),io&&a.createElement(I,{stickyCategories:Oe,categories:Y,options:po,itemsMap:uo,optionClassName:E,optionRenderer:je,activeItemIndex:$e,onActiveCategoryChanged:co,onOptionClick:go,onOptionEnter:Qe,onOptionLeave:Ce,optionLineHeight:_,shouldScrollToSelectedItem:xe,renderOnlyVisibleOptions:Re,maxOptionsWithoutScroll:He,visualFocusItemIndex:ho,id:T?"".concat(T,"-listbox"):k})),so&&!io&&!ve&&(ye?ye():a.createElement("div",{className:F.comboboxNoResults},a.createElement("div",{className:F.comboboxMessageWrapper},a.createElement("span",{className:F.comboboxMessage},oe)),te&&!K&&a.createElement(C,{className:F.addNewButton,size:W,kind:"tertiary",onClick:to},a.createElement("span",{className:F.buttonLabel},s(se)?se(Ge):se)))))})),{sizes:h,iconTypes:x.iconTypes});export{H as default};
//# sourceMappingURL=Combobox.js.map
