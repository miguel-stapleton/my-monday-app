{"version":3,"file":"usePopover.js","sources":["../../../src/hooks/usePopover.ts"],"sourcesContent":["import { useMemo } from \"react\";\nimport { usePopper } from \"react-popper\";\nimport { Placement } from \"./popoverConstants\";\nimport useIsomorphicLayoutEffect from \"./ssr/useIsomorphicLayoutEffect\";\nimport useForceUpdate from \"./useForceUpdate\";\nimport type { Options, State } from \"@popperjs/core\";\nimport { createObserveContentResizeModifier } from \"../components/Dialog/modifiers/observeContentResizeModifier\";\n\nconst { RIGHT_START, RIGHT_END, LEFT_START, LEFT_END } = Placement;\n\nconst DEFAULT_FALLBACK_PLACEMENTS = [RIGHT_END, LEFT_START, LEFT_END];\n\nexport default function usePopover(\n  referenceElement: HTMLElement,\n  popperElement: HTMLElement,\n  {\n    isOpen,\n    placement = RIGHT_START,\n    observeContentResize,\n    offset,\n    fallbackPlacements = DEFAULT_FALLBACK_PLACEMENTS\n  }: {\n    isOpen?: boolean;\n    placement?: Placement;\n    observeContentResize?: boolean;\n    offset?: [number, number];\n    fallbackPlacements?: Placement[];\n  }\n) {\n  const forceUpdate = useForceUpdate();\n\n  // we have to use forceUpdate because\n  // usePopper need to run again after any refs changes, even after the first render.\n  useIsomorphicLayoutEffect(() => {\n    forceUpdate();\n  }, [referenceElement, popperElement, forceUpdate]);\n\n  const popperOptions: Pick<Options, \"placement\" | \"modifiers\"> = useMemo(() => {\n    return {\n      placement,\n      modifiers: [\n        {\n          name: \"flip\",\n          options: {\n            fallbackPlacements\n          }\n        },\n        {\n          name: \"displayNone\",\n          enabled: true,\n          phase: \"write\",\n          fn: ({ state }: { state: State }) => {\n            state.styles.popper.visibility = isOpen ? \"visible\" : \"hidden\";\n            return state;\n          }\n        },\n        createObserveContentResizeModifier(observeContentResize),\n        offset !== undefined && {\n          name: \"offset\",\n          options: { offset }\n        }\n      ]\n    };\n  }, [placement, observeContentResize, offset, isOpen]);\n\n  const { styles, attributes } = usePopper(referenceElement, popperElement, popperOptions);\n\n  return { styles, attributes };\n}\n"],"names":["RIGHT_START","Placement","DEFAULT_FALLBACK_PLACEMENTS","RIGHT_END","LEFT_START","LEFT_END","usePopover","referenceElement","popperElement","_ref","isOpen","_ref$placement","placement","observeContentResize","offset","_ref$fallbackPlacemen","fallbackPlacements","forceUpdate","useForceUpdate","useIsomorphicLayoutEffect","popperOptions","useMemo","modifiers","name","options","enabled","phase","fn","_ref2","state","styles","popper","visibility","createObserveContentResizeModifier","undefined","_usePopper","usePopper","attributes"],"mappings":"oUAQA,IAAQA,EAAiDC,EAAjDD,YAEFE,EAA8B,CAFqBD,EAApCE,UAAoCF,EAAzBG,WAAyBH,EAAbI,UAIpB,SAAAC,EACtBC,EACAC,EAA0BC,GAazB,IAXCC,EAAMD,EAANC,OAAMC,EAAAF,EACNG,UAAAA,OAAYZ,IAAHW,EAAGX,EAAWW,EACvBE,EAAoBJ,EAApBI,qBACAC,EAAML,EAANK,OAAMC,EAAAN,EACNO,mBAAAA,OAAqBd,IAAHa,EAAGb,EAA2Ba,EAS5CE,EAAcC,IAIpBC,GAA0B,WACxBF,GACD,GAAE,CAACV,EAAkBC,EAAeS,IAErC,IAAMG,EAA0DC,GAAQ,WACtE,MAAO,CACLT,UAAAA,EACAU,UAAW,CACT,CACEC,KAAM,OACNC,QAAS,CACPR,mBAAAA,IAGJ,CACEO,KAAM,cACNE,SAAS,EACTC,MAAO,QACPC,GAAI,SAAAC,GAAgC,IAA7BC,EAAKD,EAALC,MAEL,OADAA,EAAMC,OAAOC,OAAOC,WAAatB,EAAS,UAAY,SAC/CmB,CACT,GAEFI,EAAmCpB,QACxBqB,IAAXpB,GAAwB,CACtBS,KAAM,SACNC,QAAS,CAAEV,OAAAA,KAIlB,GAAE,CAACF,EAAWC,EAAsBC,EAAQJ,IAE7CyB,EAA+BC,EAAU7B,EAAkBC,EAAeY,GAE1E,MAAO,CAAEU,OAFKK,EAANL,OAESO,WAFSF,EAAVE,WAGlB"}